<!DOCTYPE html>
<html>
<head>
	<title>Detail Admin - User list</title>
    
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	
    <!-- bootstrap -->
    <link href="../css/bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="../css/bootstrap/bootstrap-responsive.css" rel="stylesheet" />
    <link href="../css/bootstrap/bootstrap-overrides.css" type="text/css" rel="stylesheet" />

    <!-- global styles -->
    <link rel="stylesheet" type="text/css" href="../css/layout.css" />
    <link rel="stylesheet" type="text/css" href="../css/elements.css" />
    <link rel="stylesheet" type="text/css" href="../css/icons.css" />

    <!-- libraries -->
    <link href="../css/lib/font-awesome.css" type="text/css" rel="stylesheet" />
    
    <!-- this page specific styles -->
    <link rel="stylesheet" href="../css/compiled/user-list.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/compiled/index.css" type="text/css" media="screen" />

    <!-- open sans font -->
    <link href='http://fonts.useso.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css' />

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>
<body>
    <!-- navbar -->
    <div class="navbar navbar-inverse">
        <div class="navbar-inner">
            <button type="button" class="btn btn-navbar visible-phone" id="menu-toggler">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            
            <a class="brand" href="index.html"><img src="../img/logo.png" /></a>

            <ul class="nav pull-right">                
                <li class="hidden-phone">
                    <input class="search" type="text" />
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle hidden-phone" data-toggle="dropdown">
                        <span id="email"></span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="personal-info.html">个人信息</a></li>
                        <li><a href="#">修改密码</a></li>
                        <li><a href="#">意见反馈</a></li>
                    </ul>
                </li>
                <li class="settings hidden-phone">
                    <a href="../user/signout.do" role="button" data-toggle="tooltip" data-placement="bottom" title="注销">
                        <i class="icon-off"></i>
                    </a>
                </li>
            </ul>            
        </div>
    </div>
    <!-- end navbar -->

    <!-- sidebar -->
    <div id="sidebar-nav">
        <ul id="dashboard-menu">
            <li>                
                <a href="index.html">
                    <i class="icon-home"></i>
                    <span>首页</span>
                </a>
            </li>            
            <li>
                <a href="chart-showcase.html">
                    <i class="icon-signal"></i>
                    <span>导航</span>
                </a>
            </li>
            <li class="active">
                <div class="pointer">
                    <div class="arrow"></div>
                    <div class="arrow_border"></div>
                </div>
                <a class="dropdown-toggle" href="#">
                    <i class="icon-th-large"></i>
                    <span>管理广告</span>
                    <i class="icon-chevron-down"></i>
                </a>
                <ul class="active submenu">
                    <li><a href="ads-list.do" class="active">广告列表</a></li>
                    <li><a href="new-ads.do">新增广告</a></li>
                </ul>
            </li>
            <li>
                <a href="../user/user-info.do">
                    <i class="icon-cog"></i>
                    <span>个人信息</span>
                </a>
            </li>
        </ul>
    </div>
    <!-- end sidebar -->
    

	<!-- main container -->
    <div class="content">
        
        <!-- settings changer -->
        <div class="skins-nav">
            <a href="#" class="skin first_nav selected">
                <span class="icon"></span><span class="text">Default</span>
            </a>
            <a href="#" class="skin second_nav" data-file="../css/skins/dark.css">
                <span class="icon"></span><span class="text">Dark skin</span>
            </a>
        </div>
        
        <div class="container-fluid">
            <div id="pad-wrapper" class="users-list">
                <div class="row-fluid header">
                    <h3>广告列表</h3>
                    <div class="span10 pull-right">
                        <input type="text" class="span5 search" id="appPackage" name="appPackage" placeholder="输入应用包名..." />
                        
                        <!-- custom popup filter -->
                        <!-- styles are located in css/elements.css -->
                        <!-- script that enables this dropdown is located in js/theme.js -->
                        <div class="ui-dropdown">
                            <div class="head" data-toggle="tooltip" title="Click me!">
                                	过滤 广告
                                <i class="arrow-down"></i>
                            </div>  
                            <div class="dialog">
                                <div class="pointer">
                                    <div class="arrow"></div>
                                    <div class="arrow_border"></div>
                                </div>
                                <div class="body">
                                    <p class="title">
                                                                                                                         显示广告从:
                                    </p>
                                    <div class="form">
                                        <select name="advertiser" id="advertiser">
                                            <option value=""></option>
                                            <option value="Admob">Admob</option>
                                            <option value="Mobvista">Mobvista</option>
                                            <option value="InMobi">InMobi</option>
                                            <option value="Keymob">Keymob</option>
                                            <option value="Amazon">Amazon</option>
                                        </select>
                                        <select id="advertType" name="advertType">
                                            <option value="0"></option>
                                            <option value="1">插页式广告</option>
                                            <option value="2">横幅广告</option>
                                            <option value="3">视频广告</option>
                                        </select>
                                        <!-- <input type="text" /> -->
                                        <a id="add_filter" class="btn-flat small">Add filter</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <a href="new-ads.do" class="btn-flat success pull-right">
                            <span>&#43;</span>
                            	新增广告
                        </a>
                    </div>
                </div>

                <!-- Users table -->
                <div class="row-fluid table table-products">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>
                                   	应用包名
                                </th>
                                <th>
                                    <span class="line"></span>广告商
                                </th>
                                <th>
                                    <span class="line"></span>广告单元 ID
                                </th>
                                <th>
                                    <span class="line"></span>广告类型
                                </th>
                                <th>
                                    <span class="line"></span>操作
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                        	<tr><td colspan=5 style='text-align: center;'>正在加载...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination pull-right">
                    <ul id="pagination">
                    </ul>
                </div>
                <!-- end users table -->
            </div>
        </div>
    </div>
    <!-- end main container -->


	<!-- scripts -->
    <script src="../js/jquery-latest.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/theme.js"></script>
    <script src="../js/jquery.twbsPagination.min.js"></script>
    <script src="../js/common.js"></script>
    
	<script type="text/javascript">
        $(function () {
        	$.ajax({
                url: 'countAds.do',
                type: 'post',
                dataType: 'json',
                data: {"appPackage" : "", "advertiser" : "", "advertType" : 0},
                success: function (data) {
                	if(data && data.returnCode == 200) {
                		pager(data.returnObject.pages);
                	}
                }
          });
        	
        	$("input").eq(1).bind('input propertychange', function() {
        		var appPackage = $(this).val();
        		var advertiser = $("#advertiser").val();
        		var advertType = $("#advertType").val();
        		queryAdsList(appPackage, advertiser, advertType, 0);
        	});
        	
        	$("#add_filter").click(function() {
        		var appPackage = $("#appPackage").val();
        		var advertiser = $("#advertiser").val();
        		var advertType = $("#advertType").val();
        		queryAdsList(appPackage, advertiser, advertType, 0);
        	});
            
            function queryAdsList(appPackage, advertiser, advertType, page) {
            	$.ajax({
                    url: 'queryAds.do',
                    type: 'post',
                    dataType: 'json',
                    data: {"appPackage" : appPackage, "advertiser" : advertiser, "advertType" : advertType, "page" : page},
                    success: function (data) {
                   		var sb = new StringBuffer();
                    	if(data && data.returnCode == 200) {
                    		if(data.returnObject.list.length > 0) {
                    			var google_play_url = "https://play.google.com/store/apps/details?id=";
	                    		$.each(data.returnObject.list, function(index, item) {
	                    			var google_play = google_play_url + item.appPackage;
	                    			if(index == 0) {
	                    				sb.append("<tr class='first'>");
	                    			} else {
	                    				sb.append("<tr>");
	                    			}
	                    			
	                    			sb.append("<td>");
	                    			sb.append("<a href='" + google_play + "' class='name' target='blank'>" + item.appPackage + "</a>");
	                    			sb.append("</td>");
	                    			
	                    			sb.append("<td>");
	                    			sb.append(item.advertiser);
	                    			sb.append("</td>");
	                    			
	                    			sb.append("<td>");
	                    			sb.append(item.advertKey);
	                    			sb.append("</td>");
	                    			
	                    			sb.append("<td>");
	                    			sb.append(item.advertTypeName);
	                    			sb.append("</td>");
	                    			
	                    			sb.append("<td>");
	                    			sb.append("<ul class='actions'>");
	                    			sb.append("<li><i class='table-edit'></i></li>");
                   					sb.append("<li><i class='table-settings'></i></li>");
	                    			sb.append("<li class='last'><i class='table-delete'></i></li>");
	                    			sb.append("</ul>");
	                    			sb.append("</td>");
	                    			
	                    			sb.append("</tr>")
	                    		});
                    		} else {
                    			sb.append("<tr><td colspan='5' style='text-align: center;'>未检索到数据，请重试.</td></tr>");
                    			$("#pagination").empty();
                    		}
                    	} else {
                    		sb.append("<tr><td colspan=5 style='text-align: center;'>服务器出错，请联系管理员.</td></tr>");
                    		$("#pagination").empty();
                    	}
                   		$("table tbody").html(sb.toString());
                    }
              });
            }
            
            function pager(totalPages) {
            	$('#pagination').twbsPagination({
                    totalPages: totalPages,
                    visiblePages: 10,
                    last: '',
                    first: '',
                    prev: '&#8249;',
                    next: '&#8250;',
                    onPageClick: function (event, page) {
                    	var appPackage = $("#appPackage").val();
                		var advertiser = $("#advertiser").val();
                		var advertType = $("#advertType").val();
                		queryAdsList(appPackage, advertiser, advertType, page - 1);
                    }
                });
            }
            
            function StringBuffer(){ 
            	this.content = new Array; 
           	} 
           	StringBuffer.prototype.append = function(str){ 
           		this.content.push(str); 
           	} 
           	StringBuffer.prototype.toString = function(){ 
           		return this.content.join(""); 
           	}
        });
    </script>

</body>
</html>